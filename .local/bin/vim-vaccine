#!/bin/sh

dump() {
    printf "git clone '%s' \"\$HOME\"/.vim/bundle/'%s'\n" \
        "$(git --git-dir="$1"/.git config --get remote.origin.url)" "${1##*/}"
}

pull() {
    printf '## Pulling %s...\n' "${1##*/}"
    git --git-dir="$1"/.git --work-tree="$1" pull
}

usage() {
    printf 'Usage: vim-vaccine [-d]\n' >&2
    exit 2
}

case $# in
0) process=pull ;;
1) case "$1" in -d) process=dump ;; *) usage ;; esac ;;
*) usage
esac

for dir in "$HOME"/.vim/bundle/*
do
    test -d "$dir"/.git && "$process" "$dir"
done
