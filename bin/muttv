#!/bin/sh

case $# in
0|1) printf 'Usage: muttv file utility [argument...] {}\n' >&2; exit 2
esac

file=$1; shift

trap 'rm -Rf "$tmpdir"' EXIT
trap 'rm -Rf "$tmpdir"; exit 1' INT QUIT TERM
tmpdir=$(mktemp -d /tmp/muttv.XXXXXXXX) || exit 1

cp "$file" "$tmpdir" || exit 1

(
    trap 'rm -Rf "$tmpdir"; exit 1' INT QUIT TERM
    printf '%s' "$tmpdir/${file##*/}" | xargs -I {} "$@"
    rm -Rf "$tmpdir"
) &

trap - INT QUIT TERM EXIT
